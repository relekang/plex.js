<!DOCTYPE html>
<html>
	<head>
		<link rel="stylesheet" type="text/css" href="http://netdna.bootstrapcdn.com/twitter-bootstrap/2.1.0/css/bootstrap-combined.min.css">
		<title>PlexRemote</title>
		<style type="text/css">
			section{
				margin: 20px auto;
				width: 500px;
			}
			label{
				text-align:right;
			}
		</style>
	</head>
	<body>
		<section>
		<label>Server IP: <input class="input-medium" value="10.0.0." type="text" id="id_server_ip"> <i class="icon-" id="server_icon"></i></label>
		<label>Client IP: <input class="input-medium" value="10.0.0." type="text" id="id_client_ip"> <i class="icon-" id="client_icon"></i></label>

		<div>
			<h3 id="server-header"></h3>
			<div id="client-list"></div>
		</div>
		</section>
		<script src="http://code.jquery.com/jquery-1.8.1.min.js"></script>
		<script>
			$(document).ready(function(){
				var server = "";
				var client = "";
				$("#id_server_ip").change(function(){
					server = $(this).val() + ":32400";
					updateClientList();
					$("#server_icon").addClass("icon-ok-circle");
				});
				$("#id_client_ip").change(function(){
					client = $(this).val();
					$("#client_icon").addClass("icon-ok-circle");

				});
				function updateClientList(){
					$.ajax({
  						url: "http://" + server + "/clients",
						complete: function(message){
							window.console.log(message.responseText);
							var matches = new RegExp(/name="([a-zA-Z0-9\.\-\/]+)" host="([0-9\.]+)"/g).exec(message.responseText);
							window.console.log(matches);
							var clients = "";
							for(var i = 1; i < matches.length - 1; i = i + 2){
								clients += '<li><a href="#" onclick="javascript:$(\'#id_client_ip\').val(\'' + matches[i + 1] + '\').change();">' + matches[i] + ' - ' + matches[i + 1] + '</a></li>';
								window.console.log(clients);
							}

							$("#client-list").html('<h3></h3><ul class="unstyled">' + clients + '</ul>');
						}
					});

				}
			});
		</script>
	</body>
</html>